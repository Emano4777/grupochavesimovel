<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>{{ marca }} – Imóveis</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{ --bg:#0b1220; --primary:#2563eb; }
    *{box-sizing:border-box}
    body{font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;color:#111827;background:#f8fafc}

    /* Navbar / marca */
    .brandbar{background:#0f172a;}
    .brandbar .navbar-brand{color:#fff;font-weight:700}
    .brandbar .navbar-brand span{color:#60a5fa}

    /* Hero compacto com imagem ao fundo */
    .hero-compact{ height: 38vh; min-height: 260px; position: relative; display: grid; place-items: center; isolation: isolate; }
    .hero-bg{ position:absolute; inset:0; background-size:cover; background-position:center; filter:blur(2px); transform:scale(1.03); z-index:-2; }
    .hero-overlay{ position:absolute; inset:0; background: radial-gradient(1200px 600px at 70% -10%, rgba(37,99,235,.18), transparent), linear-gradient(180deg, rgba(0,0,0,.45), rgba(0,0,0,.55)); z-index:-1; }
    .hero-content{ max-width: 820px; padding: 0 16px; }
    .hero-title{ font-size: clamp(18px, 3.2vw, 28px); font-weight: 700; margin-bottom: 6px; color:#fff;}
    .hero-subtitle{ font-size: clamp(12px, 2.2vw, 16px); opacity:.95; margin-bottom: 12px; color:#e5e7eb;}
    .hero-content .btn{ padding: 6px 14px; border-radius: 999px; }

    .card img{height:260px; object-fit:cover;}
    .badge-cat{letter-spacing:.3px}
    @media (max-width: 576px){
      .hero-compact{ height: 32vh; min-height: 220px; }
      .card img{height:200px}
    }
  </style>
  <meta name="theme-color" content="#111827"/>
</head>
<body>

<!-- NAVBAR / MARCA -->
<nav class="navbar navbar-expand brandbar">
  <div class="container">
    <a class="navbar-brand" href="/"><i class="fa-solid fa-key me-2"></i>{{ marca.split(' ')[0] }} <span>{{ ' '.join(marca.split(' ')[1:]) }}</span></a>

    <!-- Busca -->
    <form class="d-flex ms-auto" role="search" method="get" action="/">
      <input class="form-control form-control-sm me-2" type="search" name="q" value="{{ q }}" placeholder="Buscar: bairro, condomínio, termos..." aria-label="Buscar">
      {% if cat %}<input type="hidden" name="cat" value="{{ cat }}">{% endif %}
      <button class="btn btn-primary btn-sm" type="submit"><i class="fa-solid fa-magnifying-glass me-1"></i> Buscar</button>
    </form>
  </div>
</nav>

<!-- HERO -->
<section class="hero-compact position-relative overflow-hidden">
  <div class="hero-bg" style="background-image:url('https://res.cloudinary.com/dizfq460q/image/upload/v1757164161/WhatsApp_Image_2025-09-06_at_09.16.30_pcmcln.jpg');"></div>
  <div class="hero-overlay"></div>

  <!-- carrossel oculto só para trocar o fundo -->
  <div id="heroCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="3500" aria-hidden="true">
    <div class="carousel-inner d-none">
      <div class="carousel-item active"><img src="https://res.cloudinary.com/dizfq460q/image/upload/v1757164161/WhatsApp_Image_2025-09-06_at_09.16.30_pcmcln.jpg" alt=""></div>
      <div class="carousel-item"><img src="https://res.cloudinary.com/dizfq460q/image/upload/v1757164163/WhatsApp_Image_2025-09-06_at_09.16.32_aibriy.jpg" alt=""></div>
      <div class="carousel-item"><img src="https://res.cloudinary.com/dizfq460q/image/upload/v1757164163/WhatsApp_Image_2025-09-06_at_09.16.31_1_wq8rj3.jpg" alt=""></div>
    </div>
  </div>

  <div class="hero-content container text-center">
    <span class="badge bg-light text-dark mb-2">Novidades</span>
    <h1 class="hero-title">Encontre seu imóvel com a {{ marca }}</h1>
    <p class="hero-subtitle">
      {{ grupos|join(', ') }} — {{ total_imoveis }} oportunidades ({{ total_venda }} à venda • {{ total_aluguel }} para aluguel)
    </p>

    <!-- Filtros de categoria -->
    <div class="d-inline-flex gap-2">
      <a href="/?{% if q %}q={{ q|urlencode }}{% endif %}" class="btn btn-outline-light btn-sm {% if not cat %}active{% endif %}">Todos</a>
      <a href="/?cat=venda{% if q %}&q={{ q|urlencode }}{% endif %}" class="btn btn-outline-light btn-sm {% if cat=='venda' %}active{% endif %}">Venda ({{ total_venda }})</a>
      <a href="/?cat=aluguel{% if q %}&q={{ q|urlencode }}{% endif %}" class="btn btn-outline-light btn-sm {% if cat=='aluguel' %}active{% endif %}">Aluguel ({{ total_aluguel }})</a>
    </div>
  </div>
</section>

<!-- LISTAGEM -->
<main id="listagem" class="container py-5">
  {% if imoveis|length == 0 %}
    <div class="alert alert-warning">Nenhum imóvel encontrado para sua busca.</div>
  {% endif %}

  <div class="row g-4">
    {% for imovel in imoveis %}
    <div class="col-12 col-md-6">
      <div class="card h-100 shadow-sm border-0 overflow-hidden">
        <!-- Carrossel -->
        <div id="carousel-{{ imovel.id }}" class="carousel slide" data-bs-ride="carousel">
          <div class="carousel-inner">
            {% for url in imovel.imagens %}
            <div class="carousel-item {% if loop.index0 == 0 %}active{% endif %}">
              <img src="{{ url }}" class="d-block w-100" alt="Foto do imóvel {{ imovel.titulo }}">
            </div>
            {% endfor %}
          </div>
          <button class="carousel-control-prev" type="button" data-bs-target="#carousel-{{ imovel.id }}" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Anterior</span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#carousel-{{ imovel.id }}" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Próximo</span>
          </button>
        </div>

        <div class="card-body p-4">
          <div class="d-flex flex-wrap gap-2 mb-2">
            <span class="badge text-bg-secondary">{{ imovel.grupo }}</span>
            <span class="badge {{ 'text-bg-success' if imovel.categoria=='venda' else 'text-bg-info' }} badge-cat">
              {{ 'Venda' if imovel.categoria=='venda' else 'Aluguel' }}
            </span>
          </div>

          <h2 class="h5 mb-2">{{ imovel.titulo }}</h2>
          <p class="text-muted small mb-3">{{ imovel.localizacao }}</p>
          <div class="d-flex align-items-baseline gap-3 mb-3">
            <div class="price h4 mb-0">{{ imovel.preco }}</div>
            {% if imovel.condominio and imovel.condominio != '—' %}
              <div class="condo text-secondary">Condomínio {{ imovel.condominio }}</div>
            {% endif %}
          </div>
          <p class="mb-3">{{ imovel.descricao_curta }}</p>
          <ul class="list-unstyled small text-secondary mb-4">
            {% for item in imovel.itens %}
            <li>✅ {{ item }}</li>
            {% endfor %}
          </ul>
          <div class="d-flex gap-2">
            <a href="#" class="btn btn-success d-flex align-items-center gap-2"
               onclick="return contatoWhats('{{ imovel.titulo|e }}', '{{ imovel.preco|e }}');">
              <i class="fab fa-whatsapp"></i> Falar no WhatsApp
            </a>
            <a href="#" class="btn btn-outline-primary"
               onclick="return compartilhar('{{ imovel.titulo|e }}', '{{ imovel.preco|e }}');">
               Compartilhar
            </a>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</main>

<footer class="py-4 bg-dark text-white-50">
  <div class="container d-flex flex-wrap justify-content-between align-items-center gap-2">
    <small>© {{ 2025 }} {{ marca }}</small>
    <small>Site desenvolvido com Flask • Hospedado na Vercel</small>
  </div>
</footer>

<script>
  // WhatsApp / Compartilhar
  const WA_BASE = "{{ wa_base }}";
  const MSG_BASE = "{{ mensagem_base }}";

  function contatoWhats(titulo, preco){
    const texto = `${MSG_BASE}. Imóvel: ${titulo} | Preço: ${preco}`;
    const url = WA_BASE + encodeURIComponent(texto);
    window.open(url, '_blank');
    return false;
  }
  async function compartilhar(titulo, preco){
    const shareData = { title: titulo, text: `${titulo} – ${preco}`, url: window.location.href };
    try {
      if (navigator.share) await navigator.share(shareData);
      else {
        await navigator.clipboard.writeText(`${shareData.title} – ${shareData.text} | ${shareData.url}`);
        alert('Link copiado!');
      }
    } catch(e){}
    return false;
  }

  // Hero BG troca com carrossel oculto
  function setHeroBackground(src){
    const bg = document.querySelector('.hero-bg');
    if(bg && src) bg.style.backgroundImage = `url('${src}')`;
  }
  (function initHeroBG(){
    const active = document.querySelector('#heroCarousel .carousel-item.active img');
    if(active) setHeroBackground(active.getAttribute('src'));
  })();
  const heroCarousel = document.getElementById('heroCarousel');
  if (heroCarousel){
    heroCarousel.addEventListener('slid.bs.carousel', function(e){
      const img = e.relatedTarget.querySelector('img');
      if(img) setHeroBackground(img.getAttribute('src'));
    });
  }
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
